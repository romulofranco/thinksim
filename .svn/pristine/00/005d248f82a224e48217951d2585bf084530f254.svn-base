package br.unicamp.fe.thinksim.dao;

import java.io.Serializable;
import java.util.List;

import javax.persistence.TypedQuery;

import org.apache.log4j.Logger;

import br.unicamp.fe.thinksim.entity.Comment;
import br.unicamp.fe.thinksim.entity.Post;

public class PostDAO extends DAOImpl<Post, Integer> implements Serializable {

	private static final long serialVersionUID = 1L;

	final static Logger logger = Logger.getLogger(PostDAO.class);

	private static PostDAO INSTANCE;

	private PostDAO() {

	}

	public synchronized static PostDAO getInstance() {
		if (INSTANCE == null) {
			INSTANCE = new PostDAO();
		}
		return INSTANCE;
	}

	public List<Comment> getComments(Long idPost) {
		TypedQuery<Comment> query = this.getEntityManager().createQuery("select c from Comment c ", Comment.class);
		// query.setParameter("id", idPost);
		return query.getResultList();
	}

	public List<Post> getAll() {
		List<Post> posts = this.getEntityManager().createQuery("select p from Post p", Post.class).getResultList();
		for (int i = 0; i > posts.size(); i++) {
			Post post = posts.get(i);
			post.setComments(this.getComments(post.getId()));
			posts.set(i, post);
		}

		return posts;

	}

}
